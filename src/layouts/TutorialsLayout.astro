---
import { type CollectionEntry } from "astro:content";
import BaseLayout from "./BaseLayout.astro";
import Image from "@components/Image/index.astro";
import { setJumpToState, type JumpToLink } from "../globals/state";
import { getCurrentLocale, useTranslations } from "../i18n/utils";

type TutorialEntry = CollectionEntry<"tutorials">;

const currentLocale = getCurrentLocale(Astro.url.pathname);
const t = await getUiTranslator(currentLocale);

const { entries } = Astro.props;

const sections = categories.map((slug) => {
  const name = categoryNames[slug];
  const sectionEntries = entries
    .filter((e: TutorialEntry) => e.data.category === slug)
    .sort((a: TutorialEntry, b: TutorialEntry) =>
      (a.data.categoryIndex ?? 1000) - (b.data.categoryIndex ?? 1000)
    );

  return { slug, name, sectionEntries };
})
---

<BaseLayout title="Tutorials">
  {sections.map(({ slug, name, sectionEntries }) => (
    <>
      <h3 id={slug}>{name}</h3>
      <ul>
        {
          sectionEntries.map((entry: TutorialEntry) => (
            <li>
              <a href={`/tutorials/${entry.slug}`}>
                {" "}
                {entry.data.featuredImageAlt && entry.data.featuredImage && (
                  <Image
                    src={entry.data.featuredImage}
                    alt={entry.data.featuredImageAlt}
                  />
                )}
                <p class="mt-sm text-body group-hover:underline">
                  {entry.data.title}
                </p>
                <p class="text-body-caption">{entry.data.description}</p>
              </a>
            </li>
          ))
        }
      </ul>
    </>
  ))}
</BaseLayout>
